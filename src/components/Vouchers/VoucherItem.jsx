import {useEffect, useState} from 'react';import axios from 'axios';import {useNavigate} from 'react-router-dom';import {useTranslation} from "react-i18next";export function VoucherItem(props) {    const {        id,        title,        description,        price,        arrivalDate,        evictionDate,        tourType,        transferType,        hotelType,        status,        hotStatus,        role,        onActionSuccess,        onRefreshVouchers    } = props;    const API_BASE_URL = import.meta.env.VITE_API_BASE_URL;    const [statusOptions, setStatusOptions] = useState([]);    const [currentStatus, setCurrentStatus] = useState(status);    const [isHot, setIsHot] = useState(hotStatus === "true");    const navigate = useNavigate();    const {t} = useTranslation();    const handleApiError = (error) => {        const message = error.response?.data?.message || error.message;        alert(message);    };    const handleApiSuccess = (response) => {        const message = response?.data?.statusMessage;        alert(message);    };    useEffect(() => {        const fetchStatusOptions = async () => {            try {                const response = await axios.get(`${API_BASE_URL}/enums/status`, {                    headers: {                        Authorization: `Bearer ${localStorage.getItem('token')}`,                    },                });                setStatusOptions(response.data);            } catch (error) {                handleApiError(error);            }        };        fetchStatusOptions();    }, [API_BASE_URL]);    const confirmAction = (message) => confirm(message);    const handleStatusChange = async (newStatus) => {        if (!confirmAction(t('voucher_item.status_confirm'))) return;        try {            const response = await axios.patch(                `${API_BASE_URL}/vouchers/${id}/status`,                {},                {                    headers: {                        Authorization: `Bearer ${localStorage.getItem('token')}`,                    },                    params: {status: newStatus},                }            );            setCurrentStatus(newStatus);            handleApiSuccess(response);            onActionSuccess(id, {status: newStatus});        } catch (error) {            handleApiError(error);        }    };    const toggleHotStatus = async () => {        if (!confirmAction(t('voucher_item.hot_confirm'))) return;        try {            const newHotStatus = !isHot;            const response = await axios.patch(                `${API_BASE_URL}/vouchers/${id}/hot`,                {},                {                    headers: {                        Authorization: `Bearer ${localStorage.getItem('token')}`,                    },                    params: {status: newHotStatus},                }            );            setIsHot(newHotStatus);            handleApiSuccess(response);            onActionSuccess(id, {hot: newHotStatus});            onRefreshVouchers();        } catch (error) {            handleApiError(error);        }    };    const handleDelete = async () => {        if (!confirmAction(t('voucher_item.delete_confirm'))) return;        try {            const response = await axios.delete(`${API_BASE_URL}/vouchers/${id}`, {                headers: {                    Authorization: `Bearer ${localStorage.getItem('token')}`,                },            });            handleApiSuccess(response);            onActionSuccess(id, null);        } catch (error) {            handleApiError(error);        }    };    const handleOrder = async () => {        if (!confirmAction(t('voucher_item.order_confirm'))) return;        try {            const response = await axios.patch(                `${API_BASE_URL}/vouchers/${id}/order?userId=${localStorage.getItem('id')}`,                {},                {                    headers: {                        Authorization: `Bearer ${localStorage.getItem('token')}`,                    },                }            );            handleApiSuccess(response);            onActionSuccess(id, {ordered: true});        } catch (error) {            handleApiError(error);        }    };    return (        <li className="voucher__item voucher-item">            <h3 className="voucher-item__name">{title}</h3>            <p className="voucher-item__description">{description}</p>            <div className="voucher-item__price">{price}</div>            <div className="voucher-item__date-wrapper">                <div>{arrivalDate}</div>                <div>-</div>                <div>{evictionDate}</div>            </div>            <div className="voucher-item__type">                <p>{t('voucher_item.tour')}:</p>                <p>{tourType}</p>            </div>            <div className="voucher-item__type">                <p>{t('voucher_item.transfer')}:</p>                <p>{transferType}</p>            </div>            <div className="voucher-item__type">                <p>{t('voucher_item.hotel')}:</p>                <p>{hotelType}</p>            </div>            <div className="voucher-item__type">                <p>{t('voucher_item.hot')}:</p>                <p>{isHot ? t('voucher_item.yes') : t('voucher_item.no')}</p>            </div>            {role === 'ADMIN' && (                <div className="voucher-item__actions">                    <p>{t('voucher_item.status')}:</p>                    <select                        value={currentStatus}                        onChange={(e) => handleStatusChange(e.target.value)}                        className="voucher-item__status-select"                    >                        {statusOptions.map((option, idx) => (                            <option key={idx} value={option}>                                {option}                            </option>                        ))}                    </select>                    <button onClick={toggleHotStatus} className="button">                        {t('voucher_item.toggle_hot')}                    </button>                    <button onClick={handleDelete} className="button">                        {t('voucher_item.delete')}                    </button>                    <button                        className="button button--add"                        onClick={() => navigate('/voucher-card', {state: {voucherId: id}})}                    >                        {t('voucher_item.update_voucher')}                    </button>                </div>            )}            {role === 'MANAGER' && (                <div className="voucher-item__actions">                    <p>Status:</p>                    <select                        value={currentStatus}                        onChange={(e) => handleStatusChange(e.target.value)}                        className="voucher-item__status-select"                    >                        {statusOptions.map((option, idx) => (                            <option key={idx} value={option}>                                {option}                            </option>                        ))}                    </select>                    <button onClick={toggleHotStatus} className="button">                        {t('voucher_item.toggle_hot')}                    </button>                </div>            )}            {role === 'USER' && (                <div className="voucher-item__actions">                    <div className="voucher-item__type">                        <p>{t('voucher_item.status')}:</p>                        <p>{status}</p>                    </div>                    <button onClick={handleOrder} className="button">                        {t('voucher_item.order')}                    </button>                </div>            )}        </li>    );}